# name: Build
# on: push

# jobs: 

#   sonarqube:
#     name: SonarQube Scan
#     runs-on: ubuntu-latest
#       steps: 
#       - name: Check out the repo
#         uses: actions/checkout@v3
#         with:
#         # Disabling shallow clone is recommended for improving relevancy of reporting
#         fetch-depth: 0
#        - name: SonarQube Scan
#          uses: sonarsource/sonarqube-scan-action@master
#         env:
#           SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
#           SONAR_URL: ${{ secrets.SONAR_URL }}


name: SonarQube Analysis

on:
  push:
    branches:
      - github-sonarqube

jobs:
  sonarqube-analysis:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      
    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: 14
        
    - name: Install dependencies
      run: npm install
    
    - name: SonarQube Scan with Debug Logging
      run: |
        npm install -g sonarqube-scanner
        sonar-scanner -X \
          -Dsonar.projectKey=your_project_key \
          -Dsonar.organization=your_organization_key \
          -Dsonar.sources=. \
          -Dsonar.host.url=https://sonarcloud.io \
          -Dsonar.login=$SONAR_TOKEN
      env:
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        
    # - name: SonarQube Scan
    #   uses: sonarsource/sonarqube-scan-action@master
    #   env:
    #     SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
    #     SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}