# name: Build
# on: push

# jobs: 

#   sonarqube:
#     name: SonarQube Scan
#     runs-on: ubuntu-latest
#       steps: 
#       - name: Check out the repo
#         uses: actions/checkout@v3
#         with:
#         # Disabling shallow clone is recommended for improving relevancy of reporting
#         fetch-depth: 0
#        - name: SonarQube Scan
#          uses: sonarsource/sonarqube-scan-action@master
#         env:
#           SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
#           SONAR_URL: ${{ secrets.SONAR_URL }}


name: SonarQube Analysis

on:
  push:
    branches:
      - github-sonarqube

jobs:
  sonarqube-analysis:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      
    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: 14
        
    - name: Install dependencies
      run: npm install
      
    - name: SonarQube Scan
      run: |
        npm install -g sonarqube-scanner
        sonar-scanner \
          -Dsonar.host.url=$SONAR_URL
          -Dsonar.login=$SONAR_TOKEN
      env:
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        SONAR_URL: ${{ secrets.SONAR_URL }}
        
    - name: Fail on SonarQube error
      run: exit 1
      if: failure()